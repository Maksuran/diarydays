<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>–õ–∏—á–Ω—ã–π –î–Ω–µ–≤–Ω–∏–∫</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>–õ–∏—á–Ω—ã–π –î–Ω–µ–≤–Ω–∏–∫</h1>
    <div class="container">
        <textarea id="entryText" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∑–∞–ø–∏—Å—å –∑–¥–µ—Å—å..." spellcheck="true" autofocus required></textarea>
        <select id="emotion">
            <option value="üòÄ">üòÄ –í–µ—Å–µ–ª—ã–π</option>
            <option value="üò¢">üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π</option>
            <option value="üò°">üò° –ó–ª–æ–π</option>
            <option value="üòå">üòå –°–ø–æ–∫–æ–π–Ω—ã–π</option>
        </select>
        <button onclick="addEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        <button onclick="exportToCSV()">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
    </div>
    <h2>–í–∞—à–∏ –∑–∞–ø–∏—Å–∏</h2>
    <ul id="entriesList"></ul>

    <script>
        function loadEntries() {
            const entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
            return entries;
        }

        function saveEntries(entries) {
            localStorage.setItem('diaryEntries', JSON.stringify(entries));
        }

        function addEntry() {
            const text = document.getElementById('entryText').value;
            const emotion = document.getElementById('emotion').value;
            const date = new Date().toLocaleString();
            if (text) {
                const entries = loadEntries();
                entries.unshift({ text, emotion, date }); // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –Ω–∞—á–∞–ª–æ –º–∞—Å—Å–∏–≤–∞
                saveEntries(entries);
                document.getElementById('entryText').value = '';
                renderEntries();
            }
        }

        function deleteEntry(index) {
            const entries = loadEntries();
            entries.splice(index, 1);
            saveEntries(entries);
            renderEntries();
        }

        function editEntry(index) {
            const entries = loadEntries();
            const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å:', entries[index].text);
            if (newText !== null) {
                entries[index].text = newText;
                saveEntries(entries);
                renderEntries();
            }
        }

        function renderEntries() {
            const entriesList = document.getElementById('entriesList');
            entriesList.innerHTML = '';
            const entries = loadEntries();
            entries.forEach((entry, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<div class="text_li">${entry.emotion} ${entry.text}</div><small>${entry.date}</small>`;
                const editButton = document.createElement('button');
                editButton.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
                editButton.onclick = () => editEntry(index);
                const deleteButton = document.createElement('button');
                deleteButton.textContent = '–£–¥–∞–ª–∏—Ç—å';
                deleteButton.onclick = () => deleteEntry(index);
                li.appendChild(editButton);
                li.appendChild(deleteButton);
                entriesList.appendChild(li);
            });
        }

        function exportToCSV() {
            const entries = loadEntries();
            const csvContent = entries.map(e => `${e.date},${e.text},${e.emotion}`).join("\n");
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "diary_entries.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        document.addEventListener('DOMContentLoaded', renderEntries);
    </script>
</body>
</html>
